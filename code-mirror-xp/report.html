<!DOCTYPE html>
<html>
<head>
    <script src="lib/codemirror.js"></script>
    <link rel="stylesheet" href="lib/codemirror.css">
    <script src="mode/clike/clike.js"></script>
    <style>
        .CodeMirror {height: auto;}
        .coverage-gutter {width: 10px;}
        .mutation-gutter {width: 10px;}

        .covered-gutter-mark {
            background-color: #ddffdd;
        }

        .uncovered-gutter-mark {
            background-color: #ffdddd;
        }

        .killed-mutant-gutter-mark {
            background-color: #aaffaa;
        }

        .survived-mutant-gutter-mark {
            background-color: #ffaaaa;
        }
    </style>
</head>
<body>

    <h1>Bonjour</h1>
    <textArea id="da-code"></textArea>

    <script>
        var editor = CodeMirror.fromTextArea(document.getElementById("da-code"), {
            lineNumbers: true,
            mode: "text/x-java",
            readOnly: true,
            gutters: ["CodeMirror-linenumbers", "coverage-gutter", "mutation-gutter"]
        });

        editor.setValue(
            "package org.pitest.aggregate;\n" +
            "\n" +
            "import java.io.File;\n" +
            "import java.util.Collection;\n" +
            "import java.util.Map;\n" +
            "\n" +
            "import org.pitest.classinfo.ClassName;\n" +
            "import org.pitest.coverage.BlockCoverage;\n" +
            "import org.pitest.coverage.BlockLocation;\n" +
            "import org.pitest.mutationtest.engine.Location;\n" +
            "import org.pitest.mutationtest.engine.MethodName;\n" +
            "\n" +
            "class BlockCoverageDataLoader extends DataLoader<BlockCoverage> {\n" +
            "\n" +
            "  private static final String METHOD     = \"method\";\n" +
            "  private static final String CLASSNAME  = \"classname\";\n" +
            "  private static final String NUMBER     = \"number\";\n" +
            "  private static final String TESTS      = \"tests\";\n" +
            "\n" +
            "  private static final String OPEN_PAREN = \"(\";\n" +
            "\n" +
            "  BlockCoverageDataLoader(final Collection<File> filesToLoad) {\n" +
            "    super(filesToLoad);\n" +
            "  }\n" +
            "\n" +
            "  @Override\n" +
            "  protected BlockCoverage mapToData(final Map<String, Object> map) {\n" +
            "    final String method = (String) map.get(METHOD);\n" +
            "    final Location location = new Location(ClassName.fromString((String) map.get(CLASSNAME)),\n" +
            "        MethodName.fromString(method.substring(0, method.indexOf(OPEN_PAREN))), method.substring(method.indexOf(OPEN_PAREN)));\n" +
            "\n" +
            "    final BlockLocation blockLocation = new BlockLocation(location, Integer.parseInt((String) map.get(NUMBER)));\n" +
            "\n" +
            "    @SuppressWarnings(\"unchecked\")\n" +
            "    final Collection<String> tests = (Collection<String>) map.get(TESTS);\n" +
            "\n" +
            "    return new BlockCoverage(blockLocation, tests);\n" +
            "  }\n" +
            "\n" +
            "}");

        function addGutterMarker(lineNumber, gutter, tagClassName) {
            var marker = document.createElement("div");
            marker.className = tagClassName;
            marker.innerHTML = "&nbsp;";

            editor.setGutterMarker(lineNumber, gutter,  marker);
        }

        function markLineCovered(lineNumber) {
            addGutterMarker(lineNumber, "coverage-gutter", "covered-gutter-mark");
        }

        function markLineUncovered(lineNumber) {
            addGutterMarker(lineNumber, "coverage-gutter", "uncovered-gutter-mark");
        }

        function markLineKilled(lineNumber) {
            addGutterMarker(lineNumber, "mutation-gutter", "killed-mutant-gutter-mark");
        }

        function markLineSurvived(lineNumber) {
            addGutterMarker(lineNumber, "mutation-gutter", "survived-mutant-gutter-mark");
        }

        markLineCovered(10);
        markLineCovered(11);
        markLineUncovered(12);
        markLineUncovered(13);


        markLineKilled(10);
        markLineKilled(11);
        markLineSurvived(12);
        markLineSurvived(13);
    </script>
</body>
</html>
